**Why:** Options‑led signals provide short‑horizon alpha; seasonality & residual momentum diversify the signal set. ([ExtractAlpha][5])

---

## 5) LLM content “hardening” (to fix your current pain)

> **Problem:** Metrics computed but not emphasized; sometimes missing data → weak narrative.

**Fixes:**

1. **Schema‑first + Validation Retry:** If the model returns invalid/partial JSON, **automatically retry** with the schema & a minimal working example. (OpenAI Structured Outputs is designed for this.) ([OpenAI Platform][1])

2. **Mandatory field coverage checks:** Reject any draft where fewer than N metrics are present; instruct the LLM to **call tools** to compute or to explicitly mark `unavailable_with_reason`. ([OpenAI Platform][10])

3. **Metric tooltips (UI + docs):** Show concise definitions and formula links next to each risk metric:

   * **Omega** captures full distribution (more tail‑aware than Sharpe). ([Institute and Faculty of Actuaries][8])
   * **GH1** compares fund return to a **vol‑matched** futures portfolio (return improvement at same risk). ([Duke University People][11])
   * **Pain/Ulcer Index** penalizes depth & duration of drawdowns (investor “stomachability”). ([ChartSchool][12])

4. **Provenance slots:** Always fill `sources[]` with provider pages (Cboe/SEC/FRED/ExtractAlpha/AlphaSense/LSEG). This tightens claims and gives your UI clickable references. ([Cboe Global Markets][6])

5. **Regime‑aware copy:** If regime = High‑Vol/Crisis, the LLM must raise **downside** language and **hedge** suggestions (puts, collars, factor hedges) and treat **options flow** with extra weight (short‑horizon). ([ExtractAlpha][5])

---

## 6) Examples the agent can follow

### Example A: DistillationAgent returns a complete Risk Panel (minimal)

```json
{
  "as_of": "2025-10-19T16:00:00Z",
  "universe": ["AAPL","MSFT","NVDA"],
  "executive_summary": {
    "top_picks": [{"ticker":"NVDA","rationale":"High ML Alpha + positive Sentiment Delta + strong options flow","expected_horizon_days":30}],
    "key_risks": ["elevated downside capture vs benchmark"],
    "thesis": "ML Alpha and options flow indicate near-term leadership; risk panel acceptable with improving Omega and controlled CVaR."
  },
  "risk_panel": {
    "omega": 1.85,
    "gh1": 2.1,
    "pain_index": 4.2,
    "upside_capture": 112.0,
    "downside_capture": 78.0,
    "cvar_95": -3.4,
    "max_drawdown": -8.9,
    "explanations": [
      "Omega>1.5 indicates favorable tail profile relative to 0% threshold.",
      "GH1>0 suggests excess return vs a vol-matched benchmark."
    ]
  },
  "signals": {
    "ml_alpha": {"score": 0.71, "explanations": ["Ensemble indicates positive excess return probability."]},
    "regime": "High-Vol",
    "sentiment": {"level": 0.35, "delta": 0.18, "explanations": ["QoQ tone improved in transcripts; social buzz rising."]},
    "smart_money": {"thirteenF": 0.22, "insider_bias": 0.05, "options_bias": 0.31, "explanations": ["Bullish options skew; modest 13F uptick."]},
    "alt_data": {"digital_demand": 0.29, "earnings_surprise_pred": 0.21, "explanations": ["Web traffic up; positive revenue surprise probability."]},
    "phase4_tech": {
      "options_flow_composite": 0.46,
      "residual_momentum": 0.33,
      "seasonality_score": 0.12,
      "breadth_liquidity": 0.28,
      "explanations": ["Low PCR + benign skew + rising volume."]
    }
  },
  "actions": [{"ticker":"NVDA","action":"buy","sizing":"+100 bps","risk_controls":"tighten stops; add put spread hedge"}],
  "sources": [
    {"title":"Cboe historical options data","url":"https://www.cboe.com/us/options/market_statistics/historical_data/","provider":"Cboe","as_of":"2025-10-18"},
    {"title":"ExtractAlpha Cross-Asset Model fact sheet","url":"https://extractalpha.com/fact-sheet/cross-asset-model/","provider":"ExtractAlpha","as_of":"2025-10-01"}
  ],
  "confidence": {"overall": 0.72, "drivers": ["consistent options bias","improving sentiment delta"]}
}
```

### Example B: Graceful degradation when data is missing

* The agent writes:
  `"phase4_tech": {"options_flow_composite": null, ...}` **and adds**
  `sources[]` entry: `{title:"Data gap: no IV chain for symbol", url:"", provider:"local", as_of:"2025-10-19"}`
* It then **calls** `jarvis.compute_options_flow` or **requests** a Cboe batch via `firecrawl` and retries the report.

---

## 7) Phase‑by‑Phase LLM‑centric plan (4→10)

### Phase 4 — **Technical & Cross‑Asset Metrics** (short‑horizon edge)

* **Build**: `technical_cross_asset.py` with `options_flow_composite`, `residual_momentum`, `seasonality_score`, `breadth_liquidity`.
* **Why**: Options market often leads; CAM shows strong short‑term edge; breadth/liquidity and seasonality add orthogonal structure. ([ExtractAlpha][5])
* **Data**: Cboe PCR/volume, IV skew; macros from FRED; doc links in tooltips. ([Cboe Global Markets][6])
* **Acceptance**: Unit tests on synthetic series; schema fields populated; sources include Cboe/ExtractAlpha/FRED.

### Phase 5 — **Fundamental & Contrarian Metrics**

* **Build**: `smart_money_index` (13F trend + insider Form‑4 bias + options bias), `expectations_divergence` (street vs crowd if integrated), `macro_sensitivity`.
* **Why**: High 13F sentiment cohorts outperformed with manageable turnover; EDGAR is the official source. ([ExtractAlpha][13])
* **Acceptance**: Backfill at least 8 quarters; compute composite; fill sources.

### Phase 6 — **Integration & Ensemble Fusion**

* **Build**: `metrics_registry` + fusion into `ml_alpha_engine` with per‑regime weights; log SHAP/permutation importance; store calibration curves.
* **Why**: Agents SDK/LangGraph simplify multi‑agent orchestration and tool wiring; keep fusion logic observable. ([OpenAI GitHub][14])
* **Acceptance**: Stable interfaces; reproducible feature columns; drift alerts when importances flip unexpectedly.

### Phase 7 — **Risk Management & Optimization**

* **Build**: CVaR‑aware position sizing; drawdown guardrails; Kelly fraction bounds; scenario stress via FRED paths; **GH1 monitor** (return uplift at same risk). ([Duke University People][11])
* **Why**: We maximize the rubric (alpha **and** risk).
* **Acceptance**: Policy reduces realized DD and CVaR in sims without sacrificing Sharpe.

### Phase 8 — **Bloomberg‑level UI/UX**

* **Build**: InvestorReport viewer with **TradingView** charts, **ECharts** heatmaps, **Dash** tables; metric tooltips with links. ([TradingView][15])
* **Why**: Fast visual diagnosis; trust via clickable sources.
* **Acceptance**: 60 FPS charting; schema renders end‑to‑end from API payload.

### Phase 9 — **Continuous Learning & Drift**

* **Build**: Auto‑retraining triggers based on **live vs backtest** gap, regime change, or eval score decay; anomaly detector watchdog.
* **Why**: Sustained edge demands quick adaptation; add tracing (LangSmith) & evals (OpenAI Evals/Ragas/TruLens). ([LangChain Docs][16])
* **Acceptance**: Alerts when IC/Sharpe or RAG correctness drops; automated canary runs.

### Phase 10 — **Performance Rubric & Monitoring**

* **Build**: Dashboard of rubric KPIs (alpha, Sharpe/Sortino, MaxDD/CVaR, breadth, uniqueness vs factors, predictive efficacy, robustness, implementation cost/latency).
* **Why**: Close the loop; prove we’re improving systemically.
* **Acceptance**: Daily rollups; diffs after each release; threshold alerts.

---

## 8) LLM Evaluation & Observability (how to measure “better”)

* **OpenAI Evals**: create small gold‑set evals for “report completeness”, “risk clarity”, “source coverage”, “action specificity”. Run nightly; keep trend lines. ([GitHub][7])
* **Ragas**: if you attach retrieved passages to the report, score **faithfulness** and **answer relevancy** (prevents source drift). ([Ragas][17])
* **TruLens/LangSmith**: trace tool calls, latency, cost; add **feedback functions** for rubric dimensions (e.g., did we include Omega+GH1+Pain?). ([TruLens][18])

---

## 9) Quick implementation checklists

**Backend**

* [ ] Enforce `InvestorReport.v1` via Structured Outputs (or server‑side JSON Schema validation). ([OpenAI Platform][1])
* [ ] Add `phase4_tech` fields to `PortfolioMetrics` and `calculate_all_metrics()`.
* [ ] Expose `compute_options_flow`, `compute_residual_momentum` as jarvis tools.
* [ ] Unit tests for options composite; synthetic PCR/IV‑skew cases; performance <200ms/asset.
* [ ] Add sources[] into API response.

**LLM Prompts**

* [ ] DistillationAgent system prompt (v2) + **schema**.
* [ ] Hard refusal rules: no invented numbers; if missing → tool call → or `unavailable_with_reason`.
* [ ] Retry on schema invalidity.

**UI**

* [ ] `PortfolioMetricsPanel` with tooltips (Omega/GH1/Pain/Capture/CVaR/MaxDD). Link to definitions. ([Institute and Faculty of Actuaries][8])
* [ ] TradingView/ECharts/Dash sections wired. ([TradingView][15])

**Eval/Obs**

* [ ] Nightly Evals (OpenAI Evals)
* [ ] Ragas scores if using retrieved passages
* [ ] Traces (LangSmith) with cost/latency and rubric coverage flags

---

## 10) Why these sources (for your agents to cite)

* **MCP, Agents SDK, Structured Outputs, Responses API** → Official OpenAI/MCP docs: **standardized tool use + guaranteed JSON** → fewer hallucinations, safer automation. ([OpenAI Platform][2])
* **Options‑led alpha** → ExtractAlpha CAM fact sheet (short‑horizon, options leads equity); **Cboe** for PCR and historical options data. ([ExtractAlpha][5])
* **Smart‑money & alt‑data** → SEC **13F** datasets (official), ExtractAlpha DRS (digital demand), AlphaSense transcript sentiment delta, LSEG MarketPsych news/social scores. ([SEC][19])
* **Risk metrics definitions** → Omega (Keating & Shadwick), GH1 (Graham–Harvey), Pain/Ulcer Index (Martin). ([Institute and Faculty of Actuaries][8])
* **Eval/obs** → OpenAI Evals, Ragas, TruLens, LangSmith docs. ([GitHub][7])

---